<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢—ñ—Ä–∫–µ–ª—É</title>
    <link rel="stylesheet" href="/css/login.css" />
</head>
<body>
<div class="container">
    <h1>–¢—ñ—Ä–∫–µ–ª—É</h1>

    <form class="login-form" onsubmit="register(event)">
        <input id="fullName" placeholder="–ê—Ç—ã" required>
        <input id="email" placeholder="–ü–æ—à—Ç–∞" required>
        <div class="password-field">
            <input type="password" name="password" placeholder="“ö“±–ø–∏—è—Å”©–∑" required id="passwordHash">
            <button type="button" class="eye-btn" id="toggleLoginPassword" tabindex="-1">üëÅÔ∏è</button>
        </div>

        <div class="user-type">
            <label><input type="radio" name="userType" value="applicant" required> –Ü–∑–¥–µ–Ω—É—à—ñ</label>
            <label><input type="radio" name="userType" value="employer"> –ñ“±–º—ã—Å –±–µ—Ä—É—à—ñ</label>
        </div>

        <button type="submit" class="login-btn">–¢—ñ—Ä–∫–µ–ª—É</button>
    </form>

    <div class="divider"><span>–ù–µ–º–µ—Å–µ</span></div>

    <p class="signup-text">
        –ê–∫–∫–∞—É–Ω—Ç –±–∞—Ä –º–∞? <a href="/login" class="signup-link">–ö—ñ—Ä—É</a>
    </p>
</div>

<script>
    const togglePwdLogin = document.getElementById("toggleLoginPassword");
    const pwdInputLogin = document.getElementById("passwordHash");

    togglePwdLogin.addEventListener("click", () => {
        if (pwdInputLogin.type === "password") {
            pwdInputLogin.type = "text";
        } else {
            pwdInputLogin.type = "password";
        }
    });
        async function register(event) {
          event.preventDefault();

          const fullName = document.getElementById("fullName").value.trim();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("passwordHash").value.trim();
          const userType = document.querySelector('input[name="userType"]:checked')?.value;

          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email)) {
            alert("–ü–æ—à—Ç–∞–Ω—ã –¥“±—Ä—ã—Å —Ñ–æ—Ä–º–∞—Ç—Ç–∞ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑! –ú—ã—Å–∞–ª—ã: example@gmail.com");
            return;
          }

          const nameParts = fullName.split(/\s+/);
          if (nameParts.length < 2) {
            alert("–¢–æ–ª—ã“õ –∞—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ (–º—ã—Å–∞–ª—ã: –ê—è–Ω –ï—Ä–º–µ–∫“±–ª—ã –Ω–µ–º–µ—Å–µ –ê—è–Ω “ö—É–∞–Ω—ã—à –ï—Ä–º–µ–∫“±–ª—ã).");
            return;
          }

          const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+\-={}[\]|:;"'<>,.?/~`]).{8,}$/;
          if (!passwordRegex.test(password)) {
            alert("“ö“±–ø–∏—è—Å”©–∑ —Ç—ã–º ”ô–ª—Å—ñ–∑! –ö–µ–º –¥–µ–≥–µ–Ω–¥–µ 8 —Ç–∞“£–±–∞, –±—ñ—Ä ”ô—Ä—ñ–ø, –±—ñ—Ä —Å–∞–Ω –∂”ô–Ω–µ –±—ñ—Ä –∞—Ä–Ω–∞–π—ã —Ç–∞“£–±–∞ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.");
            return;
          }

          if (!userType) {
            alert("–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑!");
            return;
          }

          const user = { fullName, email, passwordHash: password, userType };

          try {
            const response = await fetch("/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(user)
            });

            const data = await response.json();
            const token = data.token;

            if (response.ok && token && token !== "Registration failed") {
              localStorage.setItem("token", token);
              localStorage.setItem("userType", data.userType);
              if (data.userType === "employer") {
              window.location.href = "/homeem";
              }
              else if (data.userType === "applicant"){
              window.location.href = "/home";
              }
            } else {
              alert("–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã!");
            }
          } catch (err) {
            console.error(err);
            alert("“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã!");
          }
        }
</script>
</body>
</html>
